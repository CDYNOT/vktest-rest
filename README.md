# Упрощенный REST API сервис регистрации и авторизации на PHP

Сервис REST API на PHP с использованием MySQL, Docker, реализацией JWT токена и демонстрационным интерфейсом.

---------------------

## Реализует следующие методы

<details>
<summary><code>POST</code> <code>/register</code> - регистрация нового пользователя</summary> 

##### Описание
Этот метод используется для регистрации нового пользователя, возвращает 201 в случае успеха и 400 в случае несоответствия входных параметров требованиям

##### URL
```
/register
```

##### Параметры запроса
- **email** (обязательный, строка): Email нового пользователя.
- **password** (обязательный, строка): Пароль нового пользователя.

##### Пример тела запроса (формат JSON)
```json
{
  "email": "example@example.com",
  "password": "password123A!"
}
```

##### Коды ответа
- **201 Created**: В случае успешной регистрации нового пользователя.
- **400 Bad Request**: Если формат данных некорректен или некорректные параметры запроса.

##### Пример успешного ответа (201 Created)
```json
{ 
  "user_id": 2,
  "password_check_status": "perfect"
}
```

##### Пример ошибки формата данных (400 Bad Request)
```json
{
  "error": "invalid_email"
}
```
</details>

---------------------

<details>
<summary><code>POST</code> <code>/authorize</code> - авторизация пользователя с получением JWT токена</summary> 

##### Описание
Этот метод используется для авторизации пользователя по логину и паролю. В случа успешной авторизации сервер возвращает JWT токен

##### URL
```
/authorize
```

##### Параметры запроса
- **email** (обязательный, строка): Email существующего пользователя.
- **password** (обязательный, строка): Пароль существующего пользователя.

##### Пример тела запроса (формат JSON)
```json
{
  "email": "example@example.com",
  "password": "password123A!"
}
```

##### Коды ответа
- **200 OK**: В случае успешной авторизации.
- **400 Bad Request**: Если формат данных некорректен или некорректные параметры запроса.

##### Пример успешного ответа (200 OK)
```json
{
  "access_token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoxOX0.dQSN97nu5ILmTqNPLYNsPFY_Mq49ul0XmKgqwxw49M0"
}
```

##### Пример ошибки формата данных (400 Bad Request)
```json
{
  "error": "wrong_password"
}
```

</details>

---------------------

<details>
<summary><code>GET</code> <code>/feed</code> - проверка JWT токена из заголовка Authorization</summary>

##### Описание
Этот метод реализует проверку JWT токена, который был получен в методе `/authorize`. Токен должен быть передан в заголовке Authorization.

##### URL
```
/feed
```

##### Параметры запроса
- **Заголовок Authorization**: в заголовке необходимо передать JWT токен, полученный при авторизации.

##### Коды ответа
- **200 OK**: В случае успешной валидации JWT.
- **401 Unauthorized**: В противном случае.

</details>

---------------------

## Установка и настройка

Скачать репозиторий
```
git clone https://github.com/CDYNOT/vktest-rest.git
```

Для запуска сервиса потребуется установленный Docker, затем необходимо добавить новую строку в файл `hosts`:
```
127.0.0.1 task.loc
```
---------------------

## Запуск и работа с сервисом

Запсуск сервиса, при первичном запуске скачаются все нужные образы:
```bash
docker-compose up -d
```

Установка необходимых зависимостей и генерация autoload файла:
```bash
docker-compose exec -w /var/www/task.loc php composer install
```

После этого сервис станет доступен по адресу http://task.loc

Демонстрационный интерфейс работы сервиса доступен по адресу http://task.loc/demo.php.

Остановка сервиса:
```bash
docker-compose down
```

Для подключения к базе данных MySQL используются следующие данные:
- Host: mysql
- Имя пользователя: cdynot
- Пароль: secret
- Имя базы данных: task
- Порт: 3306

При желании, данные можно поменять в файлах `docker-compose.yml` и `/src/Database/Database.php`

---------------------